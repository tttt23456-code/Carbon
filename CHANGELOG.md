# 变更日志

本文档记录了项目的所有重要变更。

格式基于 [Keep a Changelog](https://keepachangelog.com/zh-CN/1.0.0/)，
并且本项目遵循 [语义化版本](https://semver.org/lang/zh-CN/)。

## [未发布]

### 计划中
- [ ] 员工通勤计算器
- [ ] 更多国际排放因子数据库
- [ ] 碳足迹追踪功能
- [ ] 移动端应用

## [1.0.0] - 2024-09-04

### 🎉 首次发布

这是碳排放计算系统的首个正式版本，提供了完整的企业级碳核算功能。

#### ✨ 新增功能

##### 🏗️ 核心架构
- **Monorepo 架构** - 使用 pnpm workspaces 管理多包项目
- **类型安全** - 全栈 TypeScript 支持，共享类型定义
- **现代化技术栈** - React 18 + NestJS + Prisma + PostgreSQL
- **容器化部署** - Docker 和 Docker Compose 支持
- **API 优先设计** - OpenAPI/Swagger 文档自动生成

##### 🔐 认证授权系统
- **JWT 双令牌机制** - Access Token + Refresh Token
- **多租户支持** - 组织级数据隔离
- **RBAC 权限模型** - ADMIN/MANAGER/MEMBER/READONLY 四级权限
- **安全防护** - 速率限制、CORS、安全头配置
- **审计日志** - 完整的操作追踪记录

##### 🧮 计算引擎
- **可扩展计算框架** - 插件化计算器架构
- **智能单位转换** - 支持能源、体积、质量、距离等多种单位
- **排放因子管理** - 系统内置 + 组织自定义因子
- **数据质量控制** - 测量/计算/估算三级质量标识
- **不确定性分析** - 计算结果不确定性评估

##### 📊 支持的计算类型

**Scope 1 - 直接排放**
- ⚡ **电力消耗计算器**
  - 地点法计算（电网平均排放因子）
  - 市场法计算（考虑购电协议和绿证）
  - 传输损失调整
  - 可再生能源证书处理

**Scope 2 - 能源间接排放**  
- 🔥 **燃料燃烧计算器**
  - 天然气、柴油、汽油、LPG、煤炭等
  - 基于燃料属性的精确计算
  - 碳含量法和氧化因子调整
  - 生物质燃料碳中性处理

**Scope 3 - 其他间接排放**
- ✈️ **航班排放计算器**
  - 国内/国际、短中长途分类
  - 舱位等级调整（经济/商务/头等舱）
  - RFI 辐射强迫指数效应
  - 往返航班计算

- 🚛 **货运排放计算器**
  - 公路、铁路、海运、空运多式联运
  - 载荷因子和车辆类型调整
  - 空返程排放考虑
  - 吨公里标准化计算

- 🗑️ **废弃物处理计算器**
  - 填埋、焚烧、回收、堆肥、厌氧消化
  - 甲烷回收率调整
  - 能源回收效益计算
  - 废弃物类型特性考虑

##### 📈 数据管理
- **活动数据录入** - 单条录入 + 批量导入 (CSV/Excel)
- **数据验证** - 严格的输入校验和错误报告
- **计算结果存储** - 完整的计算明细和追溯信息
- **时区处理** - UTC 存储，本地时区显示
- **软删除机制** - 数据恢复和清理策略

##### 📊 报表分析
- **多维度统计** - 按 Scope、类别、项目、设施聚合
- **时间序列分析** - 月度、季度、年度趋势
- **数据导出** - CSV、Excel 格式支持
- **可视化图表** - 柱状图、折线图、饼图（预留接口）

##### 🏢 组织管理
- **多组织支持** - 企业级多租户架构
- **设施管理** - 办公楼、工厂、仓库等设施类型
- **项目管理** - 碳中和项目跟踪
- **成员管理** - 邀请、角色分配、权限控制

#### 🛠️ 开发体验

##### 📦 包管理
- **pnpm workspaces** - 高效的 monorepo 依赖管理
- **共享包设计** - types、ui、config 包复用
- **依赖版本控制** - 统一的依赖版本管理

##### 🧪 测试框架
- **单元测试** - Jest + Supertest
- **E2E 测试** - 端到端测试框架
- **测试覆盖率** - 代码覆盖率报告
- **测试数据** - 完整的测试用例和数据

##### 🔧 开发工具
- **ESLint + Prettier** - 代码格式化和质量检查
- **Husky + lint-staged** - Git hooks 自动化
- **Commitlint** - 提交信息规范检查
- **TypeScript** - 严格模式类型检查

##### 📚 文档
- **API 文档** - Swagger/OpenAPI 自动生成
- **数据库文档** - Prisma schema 文档
- **开发手册** - 完整的开发指南
- **部署文档** - Docker 和 K8s 部署指南

#### 🚀 部署运维

##### 🐳 容器化
- **多阶段构建** - 优化的 Docker 镜像
- **健康检查** - 容器健康状态监控
- **环境变量** - 灵活的配置管理
- **日志收集** - 结构化日志输出

##### 🔄 CI/CD
- **GitHub Actions** - 自动化构建和测试
- **多环境部署** - 开发、测试、生产环境
- **代码质量检查** - 自动化代码审查
- **安全扫描** - 依赖漏洞检查

##### 📊 监控
- **健康检查端点** - 系统状态监控
- **性能指标** - 响应时间、内存使用等
- **错误追踪** - 异常日志和报告
- **数据库监控** - 查询性能和连接状态

#### 📊 数据与标准

##### 🧮 内置排放因子
- **中国电网排放因子** - 2023年国家发改委数据 (0.5810 kg CO2e/kWh)
- **IPCC 燃料因子** - 2006年指南更新版本
- **DEFRA 交通因子** - 2023年英国环境部数据
- **EPA 废弃物因子** - 美国环保署 WARM 模型

##### 📏 标准合规
- **GHG Protocol** - 温室气体核算议定书
- **ISO 14064** - 温室气体量化和报告标准
- **IPCC 指南** - 国家温室气体清单指南
- **碳足迹标准** - PAS 2050、ISO 14067 参考

#### 🌍 国际化
- **多语言支持** - 中文、英文双语界面
- **时区处理** - 全球时区支持
- **本地化配置** - 地区化数据格式
- **扩展机制** - 易于添加新语言

#### 🔒 安全功能
- **数据加密** - 敏感数据加密存储
- **输入验证** - 防止注入攻击
- **访问控制** - 细粒度权限管理
- **审计追踪** - 完整的操作记录

### 📈 性能指标

- **API 响应时间** < 200ms (P95)
- **数据库查询** < 100ms (P95)  
- **批量计算** 1000条记录 < 10s
- **内存使用** < 512MB
- **并发支持** 1000+ 用户

### 🧪 测试覆盖

- **单元测试覆盖率** > 80%
- **API 接口测试** 100% 覆盖
- **计算器测试** 全面的计算精度验证
- **E2E 测试** 主要用户流程覆盖

### 📦 技术栈版本

#### 后端
- Node.js 18.x
- NestJS 10.x
- TypeScript 5.1+
- Prisma 5.x
- PostgreSQL 15
- Redis 7.x

#### 前端
- React 18.x
- TypeScript 5.1+
- Vite 4.x
- TailwindCSS 3.x
- shadcn/ui 组件库

#### 工具链
- pnpm 8.x
- Docker 20.10+
- ESLint 8.x
- Prettier 3.x
- Jest 29.x

### 🚀 部署支持

- **Docker** - 生产就绪的容器镜像
- **Docker Compose** - 一键本地部署
- **Kubernetes** - 云原生部署配置
- **云平台** - Render、Railway、Fly.io 支持

### 📋 已知限制

1. **排放因子数据** - 当前主要包含中国、美国、英国数据
2. **计算器类型** - 暂不支持工业过程排放计算
3. **报表功能** - 高级分析功能待完善
4. **移动端** - 暂无原生移动应用

### 🔜 下一步计划

1. **扩展计算器**
   - 员工通勤排放计算
   - 工业过程排放计算
   - 产品生命周期评估

2. **数据源集成**
   - 第三方 API 接入
   - IoT 设备数据采集
   - 企业 ERP 系统集成

3. **高级功能**
   - 碳足迹追踪
   - 减排目标设定
   - 碳抵消管理

4. **用户体验**
   - 移动端应用
   - 可视化增强
   - 智能数据验证

## 致谢

感谢所有参与开发和测试的贡献者，以及提供技术支持的开源社区。

特别感谢：
- GHG Protocol 提供的标准框架
- IPCC 提供的科学指导
- 各国政府发布的排放因子数据
- 开源软件社区的技术支持

---

**让我们一起为实现碳中和目标而努力！** 🌱