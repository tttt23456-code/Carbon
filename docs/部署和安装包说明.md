# 企业碳计量数字化平台部署和安装包说明

## 项目概述

企业碳计量数字化平台是一个基于Web的碳排放计算和管理平台，采用前后端分离的架构设计。本项目不生成传统的安装包（如.exe或.dmg文件），而是提供了现代化的容器化部署方案和传统的静态文件部署方式。

## 部署方式

### 1. Docker容器化部署（推荐）

项目提供了完整的Docker配置，可以生成Docker镜像进行部署：

#### 相关文件：
- `infra/docker/Dockerfile.api` - 后端API服务Dockerfile
- `infra/docker/Dockerfile.web` - 前端Web应用Dockerfile
- `infra/docker/docker-compose.yml` - Docker Compose编排文件

#### 部署步骤：
1. 确保已安装Docker和Docker Compose
2. 进入项目根目录
3. 执行以下命令一键部署：
   ```bash
   docker-compose -f infra/docker/docker-compose.yml up -d
   ```
4. 访问 http://localhost:3000 使用系统

通过Docker compose可以一键部署整个应用栈，包括：
- 前端Web应用（Nginx服务器托管）
- 后端API服务
- 数据库服务

### 2. 传统部署方式

项目也可以通过构建生成传统的部署包：

#### 后端API部署包：
- 通过`pnpm build`命令在`apps/api`目录下生成`dist`文件夹
- 包含编译后的JavaScript文件和依赖
- 可以部署到任何支持Node.js的服务器上

#### 前端Web部署包：
- 通过`pnpm build`命令在`apps/web`目录下生成`dist`文件夹
- 包含静态HTML、CSS、JavaScript文件
- 可以部署到任何Web服务器（Nginx、Apache等）

#### 构建产物结构：
```
构建后端API：
apps/api/dist/          # 编译后的后端代码
  ├── main.js            # 入口文件
  ├── src/               # 编译后的源代码
  └── ...                # 其他依赖文件

构建前端Web：
apps/web/dist/          # 编译后的前端静态资源
  ├── index.html         # 主页面
  ├── assets/            # 静态资源文件
  ├── js/                # JavaScript文件
  └── css/               # CSS样式文件
```

### 3. 开发环境快速启动

项目提供了便捷的启动脚本：

#### 相关文件：
- `scripts/start.ps1` - Windows PowerShell脚本
- `scripts/start.sh` - Linux/Mac Shell脚本

#### 使用方法：
```bash
# Windows
.\scripts\start.ps1 dev

# Linux/Mac
./scripts/start.sh dev
```

这些脚本可以快速启动开发环境，包含数据库初始化、迁移和种子数据导入。

## 实际生成的产物

### 构建产物说明

本项目在构建过程中会生成以下产物：

1. **后端API构建产物**：
   - 位于`apps/api/dist/`目录
   - 包含编译后的TypeScript代码（转换为JavaScript）
   - 包含所有必要的依赖模块
   - 可直接在Node.js环境中运行

2. **前端Web构建产物**：
   - 位于`apps/web/dist/`目录
   - 包含优化压缩的静态资源文件
   - 包括HTML、CSS、JavaScript和图片资源
   - 可直接部署到任何静态文件服务器

3. **Docker镜像**：
   - 通过Dockerfile构建的容器镜像
   - 包含运行应用所需的所有依赖和环境
   - 可在任何支持Docker的平台上运行

## 部署建议

### 生产环境推荐配置

1. **容器化部署**：
   ```bash
   docker-compose -f infra/docker/docker-compose.yml up -d
   ```

2. **手动部署方式**：
   ```bash
   # 构建后端
   cd apps/api && pnpm build
   
   # 构建前端
   cd apps/web && pnpm build
   ```

### 环境要求

#### 软件依赖：
- Node.js 18.0及以上版本
- pnpm包管理器
- Docker（推荐，用于容器化部署）
- PostgreSQL 13+（生产环境数据库）

#### 硬件配置：
- CPU：至少4核，推荐8核
- 内存：至少8GB，推荐16GB
- 存储：至少20GB可用空间

### 配置文件

项目使用环境变量进行配置，主要配置文件包括：
- `.env` - 主要环境变量配置文件
- `.env.production` - 生产环境配置文件
- `.env.development` - 开发环境配置文件

## 日常维护

### 启动和停止服务

#### Docker方式：
```bash
# 启动服务
docker-compose -f infra/docker/docker-compose.yml up -d

# 停止服务
docker-compose -f infra/docker/docker-compose.yml down
```

#### 手动方式：
```bash
# 启动后端API
cd apps/api && pnpm start

# 启动前端Web（需要Nginx等Web服务器）
# 将apps/web/dist/目录部署到Web服务器
```

### 备份和恢复

#### 数据库备份：
```bash
# SQLite数据库备份（开发环境）
cp apps/api/db.sqlite apps/api/db.sqlite.backup

# PostgreSQL数据库备份（生产环境）
pg_dump -h hostname -U username database_name > backup.sql
```

## 故障排除

### 常见问题

1. **前端页面无法访问**：
   - 检查后端API服务是否正常运行
   - 确认环境变量配置正确
   - 查看浏览器控制台错误信息

2. **后端API启动失败**：
   - 检查数据库连接配置
   - 确认端口未被占用
   - 查看日志文件获取详细错误信息

3. **计算结果异常**：
   - 检查活动数据单位是否正确
   - 验证排放因子数据完整性
   - 确认计算方法选择正确

### 日志查看

```bash
# Docker方式查看日志
docker-compose -f infra/docker/docker-compose.yml logs

# 手动方式查看日志
# 后端日志位于 apps/api/logs/
# 前端日志通过浏览器开发者工具查看
```

## 总结

企业碳计量数字化平台提供了灵活多样的部署方案，可以根据实际需求选择最适合的方式：

1. **快速体验**：使用Docker容器化部署，一键启动
2. **开发调试**：使用开发脚本快速启动开发环境
3. **生产部署**：手动构建后分别部署前后端服务
4. **云原生**：利用构建的Docker镜像部署到Kubernetes等容器编排平台

项目虽然不生成传统意义上的安装包，但提供了现代化的部署解决方案，更加符合当前云计算和微服务的发展趋势。